#                   version: 7.16.1 (stable)
#          factory-software: 7.5
#              total-memory: 1024.0MiB
#                       cpu: ARM64
#                 cpu-count: 4
#           total-hdd-space: 128.0MiB
#         architecture-name: arm64
#                board-name: hAP ax^2
#                  platform: MikroTik
#   installed-version: 7.16.1
# Flags: U - UNDOABLE
# Columns: ACTION, BY, POLICY, TIME
#   ACTION            BY     POLICY  TIME               
# U nat rule changed  admin  write   2024-11-07 07:42:17
# U nat rule changed  admin  write   2024-11-07 07:41:17
# U nat rule changed  admin  write   2024-11-07 07:40:17
# U nat rule changed  admin  write   2024-11-07 07:39:17
# U nat rule changed  admin  write   2024-11-07 07:38:17
# U nat rule changed  admin  write   2024-11-07 07:37:17
# U dns changed       admin  write   2024-11-07 07:36:17
# U nat rule changed  admin  write   2024-11-07 00:12:27
# U dns changed       admin  write   2024-11-07 00:12:27
# U nat rule changed  admin  write   2024-11-07 00:12:17
# U nat rule changed  admin  write   2024-11-07 00:11:17
# U nat rule changed  admin  write   2024-11-07 00:10:17
# U nat rule changed  admin  write   2024-11-07 00:09:17
# U nat rule changed  admin  write   2024-11-07 00:08:17
# U nat rule changed  admin  write   2024-11-07 00:07:17
# U nat rule changed  admin  write   2024-11-07 00:06:17
# U nat rule changed  admin  write   2024-11-07 00:05:17
# U nat rule changed  admin  write   2024-11-07 00:04:17
# U nat rule changed  admin  write   2024-11-07 00:03:17
# U nat rule changed  admin  write   2024-11-07 00:02:17
# U nat rule changed  admin  write   2024-11-07 00:01:17
# U nat rule changed  admin  write   2024-11-07 00:00:17
# U nat rule changed  admin  write   2024-11-06 23:59:17
# U nat rule changed  admin  write   2024-11-06 23:58:17
# U nat rule changed  admin  write   2024-11-06 23:57:17
# U nat rule changed  admin  write   2024-11-06 23:56:17
# U nat rule changed  admin  write   2024-11-06 23:55:17
# U nat rule changed  admin  write   2024-11-06 23:54:17
# U nat rule changed  admin  write   2024-11-06 23:53:17
# U nat rule changed  admin  write   2024-11-06 23:52:17
# U nat rule changed  admin  write   2024-11-06 23:51:17
# U nat rule changed  admin  write   2024-11-06 23:50:17
# U nat rule changed  admin  write   2024-11-06 23:49:17
# U nat rule changed  admin  write   2024-11-06 23:48:17
# U nat rule changed  admin  write   2024-11-06 23:47:17
# U nat rule changed  admin  write   2024-11-06 23:46:17
# U nat rule changed  admin  write   2024-11-06 23:45:17
# U nat rule changed  admin  write   2024-11-06 23:44:17
# U nat rule changed  admin  write   2024-11-06 23:43:17
# U nat rule changed  admin  write   2024-11-06 23:42:17
# U nat rule changed  admin  write   2024-11-06 23:41:17
# U nat rule changed  admin  write   2024-11-06 23:40:17
# U nat rule changed  admin  write   2024-11-06 23:39:17
# U nat rule changed  admin  write   2024-11-06 23:38:17
# U nat rule changed  admin  write   2024-11-06 23:37:17
# U nat rule changed  admin  write   2024-11-06 23:36:17
# U nat rule changed  admin  write   2024-11-06 23:35:17
# U nat rule changed  admin  write   2024-11-06 23:34:17
# U nat rule changed  admin  write   2024-11-06 23:33:17
# U nat rule changed  admin  write   2024-11-06 23:32:17
# U nat rule changed  admin  write   2024-11-06 23:31:17
# U nat rule changed  admin  write   2024-11-06 23:30:17
# U nat rule changed  admin  write   2024-11-06 23:29:17
# U nat rule changed  admin  write   2024-11-06 23:28:17
# U nat rule changed  admin  write   2024-11-06 23:27:17
# U nat rule changed  admin  write   2024-11-06 23:26:17
# U nat rule changed  admin  write   2024-11-06 23:25:17
# U nat rule changed  admin  write   2024-11-06 23:24:17
# U nat rule changed  admin  write   2024-11-06 23:23:17
# U nat rule changed  admin  write   2024-11-06 23:22:17
# U nat rule changed  admin  write   2024-11-06 23:21:17
# U nat rule changed  admin  write   2024-11-06 23:20:17
# U nat rule changed  admin  write   2024-11-06 23:19:17
# U nat rule changed  admin  write   2024-11-06 23:18:17
# U nat rule changed  admin  write   2024-11-06 23:17:17
# U nat rule changed  admin  write   2024-11-06 23:16:17
# U nat rule changed  admin  write   2024-11-06 23:15:17
# U nat rule changed  admin  write   2024-11-06 23:14:17
# U nat rule changed  admin  write   2024-11-06 23:13:17
# U nat rule changed  admin  write   2024-11-06 23:12:17
# U nat rule changed  admin  write   2024-11-06 23:11:17
# U nat rule changed  admin  write   2024-11-06 23:10:17
# U nat rule changed  admin  write   2024-11-06 23:09:17
# U nat rule changed  admin  write   2024-11-06 23:08:17
# U nat rule changed  admin  write   2024-11-06 23:07:17
# U nat rule changed  admin  write   2024-11-06 23:06:17
# U nat rule changed  admin  write   2024-11-06 23:05:17
# U nat rule changed  admin  write   2024-11-06 23:04:17
# U nat rule changed  admin  write   2024-11-06 23:03:17
# U nat rule changed  admin  write   2024-11-06 23:02:17
# U nat rule changed  admin  write   2024-11-06 23:01:17
# U nat rule changed  admin  write   2024-11-06 23:00:17
# U nat rule changed  admin  write   2024-11-06 22:59:17
# U nat rule changed  admin  write   2024-11-06 22:58:17
# U nat rule changed  admin  write   2024-11-06 22:57:17
# U nat rule changed  admin  write   2024-11-06 22:56:17
# U nat rule changed  admin  write   2024-11-06 22:55:17
# U nat rule changed  admin  write   2024-11-06 22:54:17
# U nat rule changed  admin  write   2024-11-06 22:53:17
# U nat rule changed  admin  write   2024-11-06 22:52:17
# U nat rule changed  admin  write   2024-11-06 22:51:17
# U nat rule changed  admin  write   2024-11-06 22:50:17
# U nat rule changed  admin  write   2024-11-06 22:49:17
# U nat rule changed  admin  write   2024-11-06 22:48:17
# U nat rule changed  admin  write   2024-11-06 22:47:17
# U nat rule changed  admin  write   2024-11-06 22:46:17
# U nat rule changed  admin  write   2024-11-06 22:45:17
# U nat rule changed  admin  write   2024-11-06 22:44:17
# U nat rule changed  admin  write   2024-11-06 22:43:17
# U nat rule changed  admin  write   2024-11-06 22:42:17
# 
# software id = 9J2Q-X1IN
#
# model = C52iG-5HaxD2HaxD
# serial number = HEH08TFQ2YR
/interface bridge
add disabled=yes name=bridge-Guest
add name=bridge-IoT
add name=bridge-LAN
add name=bridge-MGMT
add disabled=yes name=bridge-Printer
add name=bridge-VoIP
add name=bridge-WLAN
/interface ethernet
set [ find default-name=ether1 ] comment="WAN - MobinNet LTE"
set [ find default-name=ether4 ] comment="DOWNLINK TMT-AF1-R1-RTR-01 (Po1 Gi1/0/47)"
set [ find default-name=ether5 ] comment="DOWNLINK TMT-AF1-R1-RTR-01 (Po1 Gi1/0/48)"
/interface bonding
add comment="DOWNLINK TMT-AF1-R1-SWT-01 (Po1)" mode=802.3ad name=bonding1 slaves=ether4,ether5 transmit-hash-policy=layer-3-and-4 up-delay=100ms
/interface vlan
add comment=MGMT interface=bonding1 name=bondig1.2 vlan-id=2
add comment="Security Devices" interface=bonding1 name=bonding1.102 vlan-id=102
add comment=VoIP interface=bonding1 name=bonding1.103 vlan-id=103
add comment=LAN interface=bonding1 name=bonding1.104 vlan-id=104
/interface list
add name=DNS_capture
/interface wifi security
add authentication-types=wpa2-psk disabled=no encryption=ccmp,gcmp,ccmp-256,gcmp-256 name="Safe Service" passphrase=Amin@sapra wps=disable
add authentication-types=wpa2-psk disabled=no encryption=ccmp,gcmp,ccmp-256,gcmp-256 name="Safe Service IoT" passphrase=021104241 wps=disable
add authentication-types=wpa2-psk disabled=no encryption=ccmp,gcmp,ccmp-256,gcmp-256 name="Safe Service Guest" passphrase=SafeService@001 wps=disable
add authentication-types=wpa2-psk disabled=no encryption=ccmp,gcmp,ccmp-256,gcmp-256 name="Safe Service Printer" passphrase=S@Pr1nT3rZ wps=disable
/interface wifi configuration
add disabled=no mode=ap name=WLAN security="Safe Service" ssid="Safe Service"
add disabled=no mode=ap name=IoT security="Safe Service IoT" ssid="Safe Service IoT"
add disabled=no mode=ap name=Guest security="Safe Service Guest" ssid="Safe Service Guest"
add disabled=no mode=ap name=Printer security="Safe Service Printer" ssid="Safe Service Printer"
/interface wifi
set [ find default-name=wifi1 ] channel.band=5ghz-ax .width=20/40mhz configuration=WLAN configuration.mode=ap .ssid=SafeService disabled=no security="Safe Service" steering.rrm=no .wnm=no
set [ find default-name=wifi2 ] channel.band=2ghz-ax .width=20mhz configuration=WLAN configuration.mode=ap .ssid=SafeService disabled=no security="Safe Service" steering.rrm=no .wnm=no
add configuration=Guest configuration.mode=ap mac-address=4A:A9:8A:CE:54:6B master-interface=wifi2 name="Guest 2.4" steering.rrm=no .wnm=no
add configuration=Guest configuration.mode=ap mac-address=4A:A9:8A:CE:54:6C master-interface=wifi1 name="Guest 5" steering.rrm=no .wnm=no
add configuration=IoT configuration.mode=ap disabled=no mac-address=4A:A9:8A:CE:54:6A master-interface=wifi2 name="IoT 2.4" steering.rrm=no .wnm=no
add configuration=IoT configuration.mode=ap disabled=no mac-address=4A:A9:8A:CE:54:69 master-interface=wifi1 name="IoT 5" steering.rrm=no .wnm=no
add configuration=Printer configuration.mode=ap mac-address=4A:A9:8A:CE:54:6D master-interface=wifi2 name="Printer 2.4" steering.rrm=no .wnm=no
add configuration=Printer configuration.mode=ap mac-address=4A:A9:8A:CE:54:6E master-interface=wifi1 name="Printer 5" steering.rrm=no .wnm=no
/ip pool
add name=pool1 ranges=192.168.88.10-192.168.88.200
add name=dhcp_pool_LAN ranges=172.16.114.21-172.16.114.254
add name=dhcp_pool_VoIP ranges=172.16.113.139-172.16.113.190
add name=dhcp_pool-WLAN ranges=172.16.115.21-172.16.115.254
add name=dhcp_pool_IoT ranges=172.16.116.11-172.16.116.126
add name=dhcp_pool_Guest ranges=172.16.116.134-172.16.116.190
add name=dhcp_pool_Printer ranges=172.16.116.198-172.16.116.254
/ip dhcp-server
add address-pool=dhcp_pool_LAN interface=bridge-LAN lease-time=2d name=dhcp-LAN
add address-pool=dhcp_pool_VoIP interface=bridge-VoIP lease-time=2d name=dhcp-VoIP
add address-pool=dhcp_pool-WLAN interface=bridge-WLAN lease-time=2d name=dhcp-WLAN
add address-pool=dhcp_pool_IoT interface=bridge-IoT lease-time=2d name=dhcp-IoT
add address-pool=dhcp_pool_Printer interface=bridge-Printer lease-time=2d name=dhcp-Printer
add address-pool=dhcp_pool_Guest interface=bridge-Guest lease-time=2d name=dhcp-Guest
/ip smb users
set [ find default=yes ] disabled=yes
/ppp profile
add change-tcp-mss=yes name=HQ use-encryption=required
/interface l2tp-client
add allow-fast-path=yes connect-to=80.210.28.192 disabled=no ipsec-secret=S@pr4min max-mru=1500 max-mtu=1500 mrru=1600 name=l2tp-AHD-AF0-R4-RTR-01 password=TMT-AF1-R1-RTR-01 profile=HQ use-ipsec=yes user=TMT-AF1-R1-RTR-01
add allow-fast-path=yes connect-to=85.198.25.40 disabled=no ipsec-secret=S@pr4min max-mru=1500 max-mtu=1500 mrru=1600 name=l2tp-AHD-CF0-R1-RTR-01 password=TMT-AF1-R1-RTR-01 profile=HQ use-ipsec=yes user=TMT-AF1-R1-RTR-01
/routing bgp template
add address-families=ip,ipv6 as=65666 disabled=no input.affinity=main multihop=yes name=HQ output.affinity=main .network=BGP_Network router-id=172.31.2.97 routing-table=main use-bfd=yes
/routing id
add disabled=no id=172.31.2.97 name=id-1 select-dynamic-id=""
/snmp community
set [ find default=yes ] addresses=172.16.0.16/32,172.16.0.24/32 name=S@Pr4NMP
/system logging action
add name=syslog remote=172.16.0.20 remote-port=1514 src-address=172.30.17.33 target=remote
/interface bridge port
add bridge=bridge-WLAN interface=wifi2
add bridge=bridge-WLAN interface=wifi1
add bridge=bridge-MGMT interface=ether2
add bridge=bridge-LAN interface=ether3
add bridge=bridge-IoT interface="IoT 2.4"
add bridge=bridge-IoT interface="IoT 5"
add bridge=bridge-IoT disabled=yes interface="Guest 2.4"
add bridge=bridge-IoT disabled=yes interface="Guest 5"
add bridge=bridge-IoT disabled=yes interface="Printer 2.4"
add bridge=bridge-IoT disabled=yes interface="Printer 5"
add bridge=bridge-LAN interface=bonding1.104
add bridge=bridge-MGMT interface=bondig1.2
add bridge=bridge-VoIP interface=bonding1.103
/ip firewall connection tracking
set udp-timeout=10s
/ip neighbor discovery-settings
set discover-interface-list=!dynamic
/interface list member
add interface=bridge-MGMT list=DNS_capture
add interface=bridge-LAN list=DNS_capture
add interface=bridge-Printer list=DNS_capture
add interface=bridge-VoIP list=DNS_capture
add interface=bridge-WLAN list=DNS_capture
add interface=bonding1.102 list=DNS_capture
/interface wifi access-list
add action=accept comment=POS disabled=no mac-address=F4:02:23:C5:D2:BA
add action=accept comment=SAPRA-P0012 disabled=no mac-address=D4:E9:8A:7C:F2:FE
add action=accept comment=SAPRA-L0026 disabled=no mac-address=D0:39:57:A3:08:37
add action=accept comment=SAPRA-L0068 disabled=no mac-address=C0:35:32:20:E4:19
add action=accept comment=SAPRA-L0071 disabled=no mac-address=B8:1E:A4:B5:28:B7
add action=reject comment="DENY ALL" disabled=yes
/ip address
add address=172.16.113.129/26 interface=bridge-VoIP network=172.16.113.128
add address=172.16.114.1/24 interface=bridge-LAN network=172.16.114.0
add address=172.16.115.1/24 interface=bridge-WLAN network=172.16.115.0
add address=172.16.116.1/25 interface=bridge-IoT network=172.16.116.0
add address=172.16.116.193/26 interface=bridge-Printer network=172.16.116.192
add address=172.16.116.129/26 interface=bridge-Guest network=172.16.116.128
add address=172.31.2.97 interface=lo network=172.31.2.97
add address=172.31.0.123 interface=lo network=172.31.0.123
add address=172.31.0.53 interface=lo network=172.31.0.53
add address=172.16.119.253/30 interface=ether1 network=172.16.119.252
add address=172.30.17.33/28 interface=bridge-MGMT network=172.30.17.32
add address=172.16.113.1/25 interface=bonding1.102 network=172.16.113.0
/ip dhcp-client
add interface=ether1 use-peer-dns=no use-peer-ntp=no
/ip dhcp-server network
add address=172.16.113.128/25 comment=Guest dns-server=172.16.0.11 gateway=172.16.113.129 ntp-server=172.31.0.123
add address=172.16.114.0/24 comment=LAN dns-server=172.16.0.11 gateway=172.16.114.1 ntp-server=172.31.0.123
add address=172.16.115.0/24 comment=WLAN dns-server=172.16.0.11 gateway=172.16.115.1 ntp-server=172.31.0.123
add address=172.16.116.0/25 comment=IoT dns-server=172.16.0.11 gateway=172.16.116.1 ntp-server=172.31.0.123
add address=172.16.116.128/26 comment=Guest dns-server=172.16.0.11 gateway=172.16.116.129 ntp-server=172.31.0.123
add address=172.16.116.192/26 comment=Printer dns-server=172.16.0.11 gateway=172.16.116.193 ntp-server=172.31.0.123
/ip dns
set allow-remote-requests=yes servers=172.16.0.11
/ip firewall address-list
add address=192.168.0.0/16 comment=RFC6890 list=bogon
add address=172.16.0.0/12 comment=RFC6890 list=bogon
add address=10.0.0.0/8 comment=RFC6890 list=bogon
add address=0.0.0.0/8 comment=RFC6890 list=bogon
add address=169.254.0.0/16 comment=RFC6890 list=bogon
add address=127.0.0.0/8 comment=RFC6890 list=bogon
add address=224.0.0.0/4 comment=Multicast list=bogon
add address=198.18.0.0/15 comment=RFC6890 list=bogon
add address=192.0.0.0/24 comment=RFC6890 list=bogon
add address=192.0.2.0/24 comment=RFC6890 list=bogon
add address=198.51.100.0/24 comment=RFC6890 list=bogon
add address=203.0.113.0/24 comment=RFC6890 list=bogon
add address=100.64.0.0/10 comment=RFC6890 list=bogon
add address=240.0.0.0/4 comment=RFC6890 list=bogon
add address=10.0.0.0/8 list=allowed_bogon_wan
add address=172.16.112.0/21 comment="Store supernet" list=BGP_Network
add address=172.30.17.32/28 comment=MGMT list=BGP_Network
add address=172.31.2.96/28 comment=Loopbacks list=BGP_Network
add address=172.16.119.254 comment="LTE Modem MGMT" list=allowed_bogon_wan
/ip firewall filter
add action=drop chain=input comment="Drop invalid input connections" connection-state=invalid
add action=drop chain=forward comment="Drop invalid connections to WAN" connection-state=invalid out-interface=ether1
add action=drop chain=forward comment="Drop invalid connections from WAN" connection-state=invalid in-interface=ether1
/ip firewall mangle
add action=mark-packet chain=prerouting content=registration dst-port=53 new-packet-mark=dns-register protocol=udp
/ip firewall nat
add action=redirect chain=dstnat comment="DNS Capture" disabled=yes dst-port=53 in-interface-list=DNS_capture protocol=udp
add action=src-nat chain=srcnat comment="WAN NAT" out-interface=ether1 to-addresses=178.131.91.173
/ip firewall raw
add action=drop chain=prerouting comment="Drop DNS from WAN" dst-port=53 in-interface=ether1 protocol=udp
add action=drop chain=prerouting comment="Drop DNS from WAN" dst-port=53 in-interface=ether1 protocol=tcp
add action=drop chain=prerouting comment="Drop suspiscious/malicious sources" src-address-list=malicious
add action=drop chain=prerouting comment="Drop suspiscious/malicious destinations" dst-address-list=malicious
add action=accept chain=prerouting comment="Allow some bogon packets from WAN" in-interface=ether1 src-address-list=allowed_bogon_wan
add action=drop chain=prerouting comment="Drop bogon packets from WAN" in-interface=ether1 src-address-list=bogon
/ip firewall service-port
set ftp disabled=yes
set tftp disabled=yes
set h323 disabled=yes
set sip disabled=yes
set pptp disabled=yes
/ip ipsec profile
set [ find default=yes ] dpd-interval=2m dpd-maximum-failures=5
/ip route
add blackhole disabled=no dst-address=172.16.112.0/21 gateway="" routing-table=main suppress-hw-offload=no
add blackhole disabled=no dst-address=172.31.2.96/28 gateway="" routing-table=main suppress-hw-offload=no
add check-gateway=ping comment="Backup route" disabled=no distance=253 dst-address=172.16.0.0/12 gateway=172.29.0.0 routing-table=main scope=30 suppress-hw-offload=no target-scope=10
add comment="Backup route" disabled=no distance=254 dst-address=172.16.0.0/12 gateway=172.29.0.16 routing-table=main scope=30 suppress-hw-offload=no target-scope=10
add check-gateway=ping comment="Backup route" disabled=no distance=253 dst-address=192.168.0.0/16 gateway=172.29.0.0 routing-table=main scope=30 suppress-hw-offload=no target-scope=10
add comment="Backup route" disabled=no distance=254 dst-address=192.168.0.0/16 gateway=172.29.0.16 routing-table=main scope=30 suppress-hw-offload=no target-scope=10
/ip service
set telnet address=172.16.0.0/12
set ftp disabled=yes
set www disabled=yes
set api disabled=yes
set winbox port=8595
set api-ssl disabled=yes
/ip ssh
set strong-crypto=yes
/routing bfd configuration
add disabled=no interfaces=l2tp-AHD-AF0-R4-RTR-01 min-rx=1s min-tx=1s multiplier=5
add disabled=no interfaces=l2tp-AHD-CF0-R1-RTR-01 min-rx=1s min-tx=1s multiplier=5
/routing bgp connection
add as=65666 disabled=no local.address=172.29.1.3 .role=ibgp .ttl=1 name=AHD-AF0-R4-RTR-01 remote.address=172.29.0.0/32 .as=65666 routing-table=main tcp-md5-key=S@PR4m1N templates=HQ
add disabled=no local.address=172.29.2.3 .role=ibgp .ttl=1 name=AHD-CF0-R1-RTR-01 remote.address=172.29.0.16/32 .as=65666 tcp-md5-key=S@PR4m1N templates=HQ
/snmp
set contact=it@sapramin.com enabled=yes location="TMT AF1 [35.758461, 51.217216]" src-address=172.30.17.33
/system clock
set time-zone-name=Asia/Tehran
/system identity
set name=TMT-AF1-R1-RTR-01
/system logging
add action=syslog topics=critical
add action=syslog topics=warning
add action=syslog topics=info
add action=syslog topics=error
add disabled=yes topics=wireless,debug
/system note
set show-at-login=no
/system ntp client
set enabled=yes
/system ntp server
set enabled=yes
/system ntp client servers
add address=time.windows.com
add address=time.google.com
add address=ir.pool.ntp.org
/system scheduler
add interval=1m name=DNS_Check on-event="/system script run DNS_Check" policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon start-time=startup
/system script
add dont-require-permissions=no name=DNS_Check owner=admin policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon source=":local PrimaryDNS \"172.16.0.11\";\r\n:local BackupDNS \"8.8.8.8,1.1.1.1,9.9.9.9\";\r\n:local TestDomain \"google.com\";\r\n\r\n:local ConfiguredDNS [/ip dns get servers];\r\n\r\n:if (\$ConfiguredDNS = \$PrimaryDNS) do={\r\n    :do {\r\n        /ip/firewall/nat/disable [find where comment=\"DNS Capture\"]\r\n        :put [:resolve \$TestDomain server \$PrimaryDNS];\r\n    } on-error={\r\n        log warning \"Primary DNS \$PrimaryDNS query failed. Setting \$BackupDNS as DNS servers\";\r\n        /ip dns set servers=\$BackupDNS;\r\n        /ip/firewall/nat/enable [find where comment=\"DNS Capture\"]\r\n    }\r\n} else={\r\n    :do {\r\n        :put [:resolve \$TestDomain server \$PrimaryDNS];\r\n        log warning \"Primary DNS \$PrimaryDNS is back online. Setting \$PrimaryDNS as DNS server\";\r\n        /ip dns set servers=\$PrimaryDNS;\r\n        /ip dns cache flush;\r\n    } on-error={ }\r\n}"
